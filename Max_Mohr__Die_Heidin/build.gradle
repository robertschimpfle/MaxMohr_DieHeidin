import java.text.SimpleDateFormat

def srcdir = 'src/main/latex'
def buildsrcdir = 'build'

task prepare(type: Exec) {
	commandLine 'mkdir', '-p', 'build'
}

task clean(type: Exec, dependsOn: prepare) {
	commandLine 'rm', '-rf', 'build'
}

task replaceVersionInfo(type: Copy, dependsOn: clean) {
	from srcdir
	into buildsrcdir
	include '**/*.tex'
	filter { line ->
		line.replace("@version@", bookVersion)
	}
	filter { line ->
		line.replace("@timestamp@", new SimpleDateFormat("dd.MM.yyyy HH:mm:ss").format(new Date()))
	}
}

task latexFirstRun(type: Exec, dependsOn: replaceVersionInfo) {
	commandLine 'pdflatex', '-output-directory', '.', 'text.tex'
	workingDir buildsrcdir
}

task latexSecondRun(type: Exec, dependsOn: latexFirstRun) {
	commandLine 'pdflatex', '-output-directory', '.', 'text.tex'
	workingDir buildsrcdir
}

task pdf(dependsOn: latexSecondRun) {
	doLast { println oink }
}
